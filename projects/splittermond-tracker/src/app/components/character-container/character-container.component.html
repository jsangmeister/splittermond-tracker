<div class="container">
  <div class="character-container">
    <div class="top-row">
      <div class="actions-left">
        <button
          matMiniFab
          (click)="historyComponent().undo()"
          [disabled]="!historyComponent().undoPossible()"
          matTooltip="Letzte Änderung rückgängig machen"
          [matTooltipDisabled]="!historyComponent().undoPossible()"
        >
          <mat-icon fontSet="material-symbols">undo</mat-icon>
        </button>
        <button
          matMiniFab
          (click)="historyComponent().redo()"
          [disabled]="!historyComponent().redoPossible()"
          matTooltip="Letzte rückgängig gemachte Änderung wiederholen"
          [matTooltipDisabled]="!historyComponent().redoPossible()"
        >
          <mat-icon fontSet="material-symbols">redo</mat-icon>
        </button>
      </div>
      <div class="action-right">
        <button
          matMiniFab
          (click)="reset()"
          matTooltip="Alle Daten des Characters zurücksetzen"
        >
          <mat-icon>replay</mat-icon>
        </button>
      </div>
    </div>

    <div class="card">
      <div class="tracker-title">
        <div>
          Splitterpunkte ({{ char().free_splinters() }}/{{
            char().max_splinters()
          }})
        </div>
      </div>
      <points-table class="splinters-table" [char]="char()" mode="splinters" />
    </div>

    <div class="card">
      <div class="tracker-title">
        <div>Lebenspunkte ({{ char().free_lp() }}/{{ char().max_lp() }})</div>
        <button
          matMiniFab
          (click)="longRest()"
          [matTooltip]="LONG_REST_TOOLTIP()"
          matTooltipClass="multiline-tooltip wide-tooltip"
          matTooltipPosition="above"
        >
          <img src="assets/sleep.png" />
        </button>
      </div>
      <points-table [char]="char()" mode="lp" />
    </div>

    <div class="card">
      <div class="tracker-title">
        <div>
          Fokuspunkte ({{ char().free_focus() }}/{{ char().max_focus() }})
        </div>
        <button
          matMiniFab
          (click)="shortRest()"
          [matTooltip]="SHORT_REST_TOOLTIP()"
          matTooltipPosition="above"
        >
          <img src="assets/rest.png" />
        </button>
      </div>
      <points-table [char]="char()" mode="focus" />
    </div>

    <history [char]="char()" />
  </div>

  <div class="middle-container">
    <div class="card">
      <div class="tracker-title">Allgemeine Fertigkeiten</div>
      <div class="grid">
        @for (skill of GENERAL_SKILLS; track skill) {
          <div>{{ GENERAL_SKILLS_LABELS[skill] }}</div>
          <div class="skill">
            <button
              matMiniFab
              nz-popover
              [nzPopoverContent]="contentTemplate"
              nzPopoverPlacement="right"
            >
              {{ char()[skill]() }}
            </button>
            <ng-template #contentTemplate>
              <div class="popover-content">
                @for (part of char()[skill].parts(); track part) {
                  <div class="label">{{ part.label }}</div>
                  <div>{{ $first ? '' : part.modifier }}</div>
                  <div class="value">{{ part.value() }}</div>
                }
                <mat-divider />
                <div class="label">Ges.</div>
                <div>=</div>
                <div class="value">{{ char()[skill]() }}</div>
              </div>
            </ng-template>
          </div>
        }
      </div>
    </div>
  </div>

  <div class="side-container">
    <div>
      <mat-button-toggle-group
        [(ngModel)]="textMode"
        [hideSingleSelectionIndicator]="true"
      >
        @for (mode of TEXT_MODES; track mode.value) {
          <mat-button-toggle [value]="mode.value">
            <mat-icon>{{ mode.icon }}</mat-icon>
          </mat-button-toggle>
        }
      </mat-button-toggle-group>
    </div>
    <div class="note-container">
      @if (textMode() !== 'markdown') {
        <textarea
          #note
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          (input)="char().note.set(note.value)"
          >{{ char().note() }}</textarea
        >
      }
      @if (textMode() !== 'source') {
        <markdown [data]="char().note()"></markdown>
      }
    </div>
  </div>
</div>
